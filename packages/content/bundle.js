const b=[{id:"fmkorea",match:/https?:\/\/(www\.)?fmkorea\.com\//i,articleMatch:/(\/best\/)|\/(\d+)(?:$|[?#])|index\.php\?mid=/i,skipClosest:".mediaelement_video, .document_address",ruleId:"fmkorea"}];function u(){return b.find(t=>t.match.test(location.href))||null}function p(){const t=u();return!(!t||t.articleMatch&&!t.articleMatch.test(location.href))}function E(t){const c=document.querySelector("article"),i=c&&(c.querySelector("h1,h2,h3")?.textContent||"").trim()||document.title||"제목 없음";if(!c)return{title:i,blocks:[]};const s=t&&t.skipClosest,o=[],a=new Set;c.querySelectorAll("img").forEach(e=>{if(s&&e.closest(s))return;const n=e.getAttribute("data-src")||e.getAttribute("data-original")||e.src;!n||a.has(n)||(a.add(n),o.push({type:"image",src:n,alt:e.alt||""}))});const l=new Set;c.querySelectorAll("p, h1, h2, h3, h4, h5, h6, li, blockquote, pre").forEach(e=>{if(s&&e.closest(s))return;const n=(e.textContent||"").replace(/\s+/g," ").trim();n&&(n.length===1&&/[\p{P}\p{S}]/u.test(n)||l.has(n)||(l.add(n),e.tagName==="PRE"?o.push({type:"html",html:e.outerHTML}):o.push({type:"html",html:e.innerHTML.trim()})))}),o.some(e=>e.type==="html")||c.innerText.split(/\n+/).map(n=>n.trim()).filter(n=>n.length>1).forEach(n=>{l.has(n)||(l.add(n),o.push({type:"html",html:n}))});try{console.debug("[FLICK fmkorea extract]",{images:a.size,textBlocks:o.filter(e=>e.type==="html").length})}catch{}return{title:i,blocks:o}}const w={fmkorea:E};function h(){const t=u();if(!t)return{title:"지원되지 않는 사이트",blocks:[]};const c=w[t.ruleId];try{return typeof c=="function"?c(t)||{title:document.title||"제목 없음",blocks:[]}:{title:document.title||"제목 없음",blocks:[]}}catch(i){return console.error("[FLICK extract error]",i),{title:document.title||"제목 없음",blocks:[]}}}function k(t){if(document.querySelector(".flick-wrap-injected"))return;const c=document.createElement("div");c.className="flick-wrap-injected";const i=document.createElement("div");i.className="flick-stage flick-fade-in";const s=document.createElement("div");s.className="flick-header";const o=document.createElement("div");o.className="flick-title",o.textContent=t.title,o.contentEditable="true",o.spellcheck=!1,o.title="제목 수정 가능";const a=r=>{document.activeElement===o&&(r.type==="keydown"&&r.key==="Enter"&&r.preventDefault(),r.stopImmediatePropagation())};["keydown","keypress","keyup"].forEach(r=>window.addEventListener(r,a,!0)),s.appendChild(o);const l=document.createElement("div");l.className="flick-body",t.blocks.forEach(r=>{if(r.type==="image"){const e=document.createElement("img");e.className="flick-img",e.src=r.src,e.alt=r.alt||"",l.appendChild(e)}else if(r.type==="html"){const e=document.createElement("div");e.className="flick-block",e.innerHTML=r.html,l.appendChild(e)}});const d=document.createElement("div");d.className="flick-footer",d.innerHTML="<span>Flick Prototype</span>",i.appendChild(s),i.appendChild(l),i.appendChild(d),c.appendChild(i),document.body.appendChild(c),document.body.classList.add("flick-body-lock"),document.addEventListener("keydown",function(e){e.key==="Escape"&&m()},{once:!0})}function m(){const t=document.querySelector(".flick-wrap-injected");t&&(t.remove(),document.body.classList.remove("flick-body-lock"))}const C={isSupportedArticle:p,getActiveSiteConfig:u,extractPost:h,buildUI:k,closeShorts:m};window.FLICK=C;function S(){const t=h();k(t)}function y(){!!document.querySelector(".flick-wrap-injected")?m():S(),g()}function f(){if(!p()||document.querySelector(".flick-toggle-btn"))return;const t=document.createElement("button");t.className="flick-toggle-btn flick-toggle-floating",t.type="button",t.textContent="쇼츠 보기",t.addEventListener("click",y),document.body.appendChild(t),g()}function g(){const t=document.querySelector(".flick-toggle-btn");if(!t)return;const c=!!document.querySelector(".flick-wrap-injected");t.textContent=c?"쇼츠 닫기":"쇼츠 보기"}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f();window.addEventListener("keydown",t=>{const c=t.target&&t.target.tagName||"";["INPUT","TEXTAREA"].includes(c)||t.target?.isContentEditable||t.key==="F4"&&(t.preventDefault(),y())});
